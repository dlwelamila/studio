{
  "entities": {
    "Helper": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Helper",
      "type": "object",
      "description": "Represents a service provider on the tasKey platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Helper entity."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The helper's primary phone number for registration and communication."
        },
        "email": {
          "type": "string",
          "description": "Optional email address for the helper.",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the helper."
        },
        "profilePhotoUrl": {
          "type": "string",
          "description": "URL of the helper's profile photo.",
          "format": "uri"
        },
        "serviceCategories": {
          "type": "array",
          "description": "An array of service categories the helper provides (e.g., Laundry, Cleaning).",
          "items": {
            "type": "string"
          }
        },
        "serviceAreas": {
          "type": "array",
          "description": "An array of service areas (ward / neighborhood) the helper operates in.",
          "items": {
            "type": "string"
          }
        },
        "aboutMe": {
          "type": "string",
          "description": "A short 'About me' description provided by the helper."
        },
        "references": {
          "type": "string",
          "description": "Optional references provided by the helper."
        },
        "additionalSkills": {
          "type": "string",
          "description": "Optional additional skills listed by the helper."
        },
        "verificationStatus": {
          "type": "string",
          "description": "The verification status of the helper (Pending Verification, Verified Helper)."
        },
        "availability": {
          "type": "boolean",
          "description": "Indicates if the helper is currently available for tasks."
        },
        "reliabilityIndicator": {
          "type": "string",
          "description": "Indicator of the helper's reliability (ðŸŸ¢ðŸŸ¡ðŸ”´)."
        }
      },
      "required": [
        "id",
        "phoneNumber",
        "fullName",
        "profilePhotoUrl",
        "serviceCategories",
        "serviceAreas",
        "aboutMe",
        "verificationStatus",
        "availability",
        "reliabilityIndicator"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who posts tasks on the tasKey platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer entity."
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the customer."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The customer's phone number for contact."
        },
        "email": {
          "type": "string",
          "description": "The customer's email address.",
          "format": "email"
        },
        "rating": {
          "type": "number",
          "description": "Average rating given by helpers to this customer."
        }
      },
      "required": [
        "id",
        "fullName",
        "phoneNumber"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task posted by a customer on the tasKey platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Task)"
        },
        "taskType": {
          "type": "string",
          "description": "The type of task (e.g., Laundry, Cleaning)."
        },
        "description": {
          "type": "string",
          "description": "A description of the task."
        },
        "area": {
          "type": "string",
          "description": "The approximate area where the task needs to be performed."
        },
        "landmark": {
          "type": "string",
          "description": "A landmark near the task location."
        },
        "budgetRange": {
          "type": "string",
          "description": "The budget range for the task."
        },
        "expectedEffort": {
          "type": "string",
          "description": "The expected effort level (light / medium / heavy)."
        },
        "preferredTimeWindow": {
          "type": "string",
          "description": "The preferred time window for the task to be completed."
        },
        "status": {
          "type": "string",
          "description": "The current status of the task (OPEN, ASSIGNED, COMPLETED)."
        },
        "assignedHelperId": {
          "type": "string",
          "description": "Reference to Helper assigned to this task. (Relationship: Helper 1:N Task)"
        }
      },
      "required": [
        "id",
        "customerId",
        "taskType",
        "description",
        "area",
        "expectedEffort",
        "preferredTimeWindow",
        "status"
      ]
    },
    "Offer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Offer",
      "type": "object",
      "description": "Represents an offer submitted by a helper for a specific task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Offer entity."
        },
        "helperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Offer)"
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Offer)"
        },
        "price": {
          "type": "number",
          "description": "The price offered by the helper for the task."
        },
        "availabilityEta": {
          "type": "string",
          "description": "The helper's availability and estimated time of arrival (ETA)."
        },
        "message": {
          "type": "string",
          "description": "A short message from the helper to the customer."
        },
        "status": {
          "type": "string",
          "description": "The status of the offer (ACTIVE, WITHDRAWN, ACCEPTED, REJECTED)."
        }
      },
      "required": [
        "id",
        "helperId",
        "taskId",
        "price",
        "availabilityEta",
        "message",
        "status"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review given by a customer for a completed task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Review entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Review)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Review)"
        },
        "helperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "The rating given by the customer (e.g., 1 to 5 stars)."
        },
        "feedback": {
          "type": "string",
          "description": "Short feedback provided by the customer."
        }
      },
      "required": [
        "id",
        "taskId",
        "customerId",
        "helperId",
        "rating",
        "feedback"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/workers/{workerId}",
        "definition": {
          "entityName": "Helper",
          "schema": {
            "$ref": "#/backend/entities/Helper"
          },
          "description": "Stores helper profiles.  Only the authenticated user (helper) can access and modify their own profile. Includes the 'id' field which corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "workerId",
              "description": "The Firebase Auth UID of the helper."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores task details. Accessible for listing to all authenticated users (helpers). Write access restricted to authorized customers.",
          "params": [
            {
              "name": "taskId",
              "description": "Unique identifier for the task."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}/offers/{offerId}",
        "definition": {
          "entityName": "Offer",
          "schema": {
            "$ref": "#/backend/entities/Offer"
          },
          "description": "Stores offers made by helpers for specific tasks. Includes denormalized 'helperId' and 'taskId' for authorization independence.",
          "params": [
            {
              "name": "taskId",
              "description": "The ID of the task the offer is for."
            },
            {
              "name": "offerId",
              "description": "Unique identifier for the offer."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores reviews given by customers for completed tasks. Includes denormalized 'taskId', 'customerId', and 'helperId' for authorization independence.",
          "params": [
            {
              "name": "reviewId",
              "description": "Unique identifier for the review."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles. Only accessible to administrators.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a clear separation of concerns, optimize for security and scalability, and support the core features of the tasKey application. It leverages path-based ownership and denormalization to ensure authorization independence and efficient data access. The structure facilitates simple, robust, and easily debuggable security rules.\n\n*   **Authorization Independence:** Authorization is enforced without relying on hierarchical `get()` calls. For instance, access to `offers` related to a `task` does not require fetching the `task` document. This is achieved by storing the `helperId` and `taskId` directly within the `offers` document.\n*   **Structural Segregation:** Each collection is designed with a homogeneous security posture. For example, `/workers/{workerId}` stores only worker-related data, ensuring consistent access control rules. Similarly, `/tasks` are open and discoverable, while specific details and offers are managed under the task document itself.\n*   **Access Modeling:** Path-based ownership is used for the `workers` collection, ensuring that only the authenticated user (helper) can access and modify their profile data. The `tasks` collection are globally accessible for reading but have restricted write access. Offers are stored as subcollections, enabling granular control over who can create, modify, or view them.\n\n**QAPs (Rules are not Filters):**\n*   The structure allows for secure `list` operations. For example, a helper can `list` tasks in their area without requiring complex filtering on the client-side. Security rules can efficiently restrict access based on the `area` field in the `tasks` collection.\n\n**Denormalization Strategy:** The `offers` subcollection denormalizes data by including `helperId` and `taskId`. This eliminates the need for security rules to perform `get()` operations on the `workers` or `tasks` collections to validate authorization. Similarly, the `reviews` document denormalizes `taskId`, `customerId`, and `helperId` to make it independent.\n\n**Additional Notes:**\n*   The structure supports the integrity of ownership by associating `tasks` with `customerId` and `offers` with `helperId`.\n*   The use of status fields in `Task` and `Offer` entities enables explicit state modeling, simplifying both application logic and security rules.\n*   The structure is designed to be extensible to support future features such as team-based work and recurring assistance."
  }
}