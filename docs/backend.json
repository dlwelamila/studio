{
  "entities": {
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who needs assistance with tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer entity."
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the customer."
        },
        "email": {
          "type": "string",
          "description": "The email address of the customer.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The unique, verified phone number of the customer."
        }
      },
      "required": [
        "id",
        "fullName",
        "phoneNumber"
      ]
    },
    "Helper": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Helper",
      "type": "object",
      "description": "Represents a helper who provides assistance with tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the helper entity."
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the helper."
        },
        "email": {
          "type": "string",
          "description": "The email address of the helper.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The unique, verified phone number of the helper."
        },
        "aboutMe": {
          "type": "string",
          "description": "A short biography of the helper."
        },
        "isAvailable": {
            "type": "boolean"
        },
        "serviceCategories": {
            "type": "array",
            "items": { "type": "string" }
        },
        "serviceAreas": {
            "type": "array",
            "items": { "type": "string" }
        },
        "stats": {
            "type": "object",
            "properties": {
                "totalAttempted": { "type": "number" },
                "jobsCompleted": { "type": "number" },
                "jobsCancelled": { "type": "number" },
                "completionRate": { "type": "number" },
                "ratingAvg": { "type": "number" },
                "reliabilityLevel": { "type": "string", "enum": ["GREEN", "YELLOW", "RED"] }
            }
        },
        "walletSummary": {
          "type": "object",
          "properties": {
            "lifetimeEarnings": { "type": "number" },
            "currency": { "type": "string", "enum": ["TZS"] }
          }
        },
        "verificationStatus": {
            "type": "string",
            "enum": ["PENDING", "APPROVED", "SUSPENDED"]
        }
      },
      "required": [
        "id",
        "fullName",
        "phoneNumber",
        "serviceCategories",
        "serviceAreas",
        "aboutMe"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task posted by a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Task)"
        },
        "title": {
          "type": "string",
          "description": "The title of the task."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the task."
        },
        "category": {
          "type": "string",
          "description": "The category of the task (e.g., Cleaning, Laundry)."
        },
        "location": {
          "type": "string",
          "description": "The location where the task needs to be performed."
        },
        "budget": {
          "type": "number",
          "description": "The budget allocated for the task."
        },
        "status": {
          "type": "string",
          "description": "The current status of the task (e.g., Open, Assigned, Completed, IN_DISPUTE, REASSIGNED)."
        },
        "assignedHelperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Task). Nullable if task is not assigned."
        },
        "createdAt": { "type": "string", "format": "date-time" },
        "assignedAt": { "type": "string", "format": "date-time" },
        "startedAt": { "type": "string", "format": "date-time" },
        "completedAt": { "type": "string", "format": "date-time" },
        "disputedAt": { "type": "string", "format": "date-time" }
      },
      "required": [
        "id",
        "customerId",
        "title",
        "description",
        "category",
        "location",
        "budget",
        "status",
        "createdAt"
      ]
    },
    "Offer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Offer",
      "type": "object",
      "description": "Represents an offer submitted by a helper for a task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the offer entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Offer)"
        },
        "helperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Offer)"
        },
        "price": {
          "type": "number",
          "description": "The price offered by the helper."
        },
        "availability": {
          "type": "string",
          "description": "The helper's availability to perform the task."
        },
        "message": {
          "type": "string",
          "description": "A message from the helper to the customer."
        }
      },
      "required": [
        "id",
        "taskId",
        "helperId",
        "price",
        "availability",
        "message"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator who manages the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the admin."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the admin."
        },
        "email": {
          "type": "string",
          "description": "The email address of the admin.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Rating": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Rating",
      "type": "object",
      "description": "Represents a rating given by a customer to a helper after task completion.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the rating entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Rating)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Rating)"
        },
        "helperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Rating)"
        },
        "rating": {
          "type": "number",
          "description": "The rating value (e.g., 1 to 5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment from the customer."
        }
      },
      "required": [
        "id",
        "taskId",
        "customerId",
        "helperId",
        "rating"
      ]
    },
    "SupportTicket": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Support Ticket",
      "type": "object",
      "description": "Represents a support ticket submitted by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the support ticket."
        },
        "userId": {
          "type": "string",
          "description": "The Firebase Auth UID of the user submitting the ticket."
        },
        "userEmail": {
          "type": "string",
          "description": "The email of the user submitting the ticket."
        },
        "subject": {
          "type": "string",
          "description": "The subject of the support ticket."
        },
        "message": {
          "type": "string",
          "description": "The detailed message from the user."
        },
        "status": {
          "type": "string",
          "enum": ["NEW", "IN_PROGRESS", "RESOLVED"],
          "description": "The current status of the support ticket."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "userEmail",
        "subject",
        "message",
        "status",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/customers/{userId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profile data. The document ID is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/helpers/{userId}",
        "definition": {
          "entityName": "Helper",
          "schema": {
            "$ref": "#/backend/entities/Helper"
          },
          "description": "Stores helper profile data. The document ID is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks created by customers. Includes denormalized 'customerId' for authorization independence.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique ID of the task."
            }
          ]
        }
      },
      {
        "path": "/offers/{offerId}",
        "definition": {
          "entityName": "Offer",
          "schema": {
            "$ref": "#/backend/entities/Offer"
          },
          "description": "Stores offers made by helpers for tasks. Includes denormalized 'helperId' and 'taskId' for authorization independence.",
          "params": [
            {
              "name": "offerId",
              "description": "The unique ID of the offer."
            }
          ]
        }
      },
      {
        "path": "/ratings/{ratingId}",
        "definition": {
          "entityName": "Rating",
          "schema": {
            "$ref": "#/backend/entities/Rating"
          },
          "description": "Stores ratings given by customers to helpers. Includes denormalized 'taskId', 'customerId', and 'helperId' for authorization independence.",
          "params": [
            {
              "name": "ratingId",
              "description": "The unique ID of the rating."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Indicates admin status. Document existence determines admin role.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
       {
        "path": "/support_tickets/{ticketId}",
        "definition": {
          "entityName": "SupportTicket",
          "schema": {
            "$ref": "#/backend/entities/SupportTicket"
          },
          "description": "Stores support tickets submitted by users.",
          "params": [
            {
              "name": "ticketId",
              "description": "The unique ID of the support ticket."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the tasKey application, focusing on task management, user roles (Customers, Helpers, Admins), and efficient data access with robust security rules.  The key principle is Authorization Independence, achieved through denormalization. For example, tasks denormalize customerId, and offers denormalize helperId and taskId, allowing rules to validate access without needing to `get()` parent documents. \n\n*   **Customers:** `/customers/{userId}` stores customer profiles.\n*   **Helpers:** `/helpers/{userId}` stores helper profiles.\n*   **Tasks:** `/tasks/{taskId}` stores task documents. Tasks denormalize `customerId` to ensure Authorization Independence.\n*   **Offers:** `/tasks/{taskId}/offers/{offerId}` is a subcollection within each task. This simplifies security rules as access to offers can be inherited from the parent task.\n*   **Ratings:** Ratings are stored in `/ratings/{ratingId}`. They denormalize `taskId`, `customerId`, and `helperId` for authorization independence and simpler querying.\n*   **Admins:** Admin status is managed via document existence in `/roles_admin/{userId}`.  This leverages the \"existence over content\" pattern for global role management.\n\n\n**QAPs (Rules are not Filters):**\n\n*   The structure supports secure `list` operations.\n*   Helpers can list all documents in the `/tasks` collection, but rules on `get` will prevent them from reading full details of tasks they are not involved in.\n\nThis structure adheres to all core design principles and strategy mandates, ensuring a secure, scalable, and debuggable Firestore database for the tasKey application."
  }
}