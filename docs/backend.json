{
  "entities": {
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who requests tasks on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone"
      ]
    },
    "Helper": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Helper",
      "type": "object",
      "description": "Represents a helper who provides services on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the helper entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the helper."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the helper."
        },
        "email": {
          "type": "string",
          "description": "Email address of the helper.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the helper."
        },
        "address": {
          "type": "string",
          "description": "Address of the helper."
        },
        "skills": {
          "type": "array",
          "description": "List of skills the helper possesses.",
          "items": {
            "type": "string"
          }
        },
        "serviceAreas": {
          "type": "array",
          "description": "List of areas the helper provides service in.",
          "items": {
            "type": "string"
          }
        },
        "verified": {
          "type": "boolean",
          "description": "Indicates whether the helper's profile is verified by an administrator."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "serviceAreas"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task posted by a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Task)"
        },
        "category": {
          "type": "string",
          "description": "Category of the task (e.g., Cleaning, Laundry)."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the task."
        },
        "location": {
          "type": "object",
          "properties": {
            "geo": {
              "type": "string",
              "description": "GeoPoint for the task location"
            },
            "areaName": {
              "type": "string",
              "description": "Name of the area for the task"
            }
          }
        },
        "budgetRange": {
          "type": "string",
          "description": "The specified budget range for the task."
        },
        "status": {
          "type": "string",
          "description": "Current status of the task (e.g., Open, Assigned, In Progress, Completed)."
        },
        "assignedHelperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Task).  Null if not assigned."
        },
        "effort": {
          "type": "string",
          "description": "Estimated effort required for the task.",
          "enum": [
            "light",
            "medium",
            "heavy"
          ]
        },
        "toolsRequired": {
          "type": "array",
          "description": "A list of tools expected for the task.",
          "items": {
            "type": "string"
          }
        },
        "timeWindow": {
          "type": "string",
          "description": "A string representing the preferred time window for the task."
        }
      },
      "required": [
        "id",
        "customerId",
        "category",
        "description",
        "location",
        "status",
        "effort"
      ]
    },
    "Offer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Offer",
      "type": "object",
      "description": "Represents an offer submitted by a helper for a specific task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the offer entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Offer)"
        },
        "helperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Offer)"
        },
        "price": {
          "type": "number",
          "description": "Price offered by the helper for the task."
        },
        "availability": {
          "type": "string",
          "description": "The availability that the helper would be able to perform the task."
        },
        "message": {
          "type": "string",
          "description": "Additional message from the helper regarding the offer."
        }
      },
      "required": [
        "id",
        "taskId",
        "helperId",
        "price",
        "availability"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents feedback provided by a customer after a task is completed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the feedback entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:1 Feedback)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Feedback)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the customer (e.g., 1 to 5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment provided by the customer."
        }
      },
      "required": [
        "id",
        "taskId",
        "customerId",
        "rating"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the administrator."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the administrator."
        },
        "email": {
          "type": "string",
          "description": "Email address of the administrator.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles. Uses path-based ownership for private data.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier of the customer."
            }
          ]
        }
      },
      {
        "path": "/helpers/{helperId}",
        "definition": {
          "entityName": "Helper",
          "schema": {
            "$ref": "#/backend/entities/Helper"
          },
          "description": "Stores helper profiles. Uses path-based ownership for private data.",
          "params": [
            {
              "name": "helperId",
              "description": "The unique identifier of the helper."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores task details. Includes 'customerId' for authorization independence.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique identifier of the task."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}/offers/{offerId}",
        "definition": {
          "entityName": "Offer",
          "schema": {
            "$ref": "#/backend/entities/Offer"
          },
          "description": "Stores offers for a specific task. Includes 'helperId' and 'taskId' for authorization.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique identifier of the task."
            },
            {
              "name": "offerId",
              "description": "The unique identifier of the offer."
            }
          ]
        }
      },
      {
        "path": "/feedbacks/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Stores feedback provided by customers for completed tasks. Includes 'customerId' and 'taskId' for authorization.",
          "params": [
            {
              "name": "feedbackId",
              "description": "The unique identifier of the feedback."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Collection used to grant admin privileges. Existence of a document grants admin role.",
          "params": [
            {
              "name": "uid",
              "description": "The unique identifier of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the tasKey application's core features, focusing on task management, helper services, and user roles. The structure emphasizes authorization independence and straightforward security rules.\n\n**Authorization Independence:**\n*   For tasks created by customers, the `customerId` is included directly within the `/tasks/{taskId}` document. This eliminates the need to perform a `get()` operation to authorize access based on the customer who created the task. Offers made by helpers include the `helperId` and `taskId` to ensure that the offer can be validated against the relevant task and authorized against the helper making the offer. Feedback also includes `customerId` and `taskId` so it can be validated to only allow feedback from the customer that created the task.\n\n**Structural Segregation:**\n*   Customers and Helpers are stored in separate collections (`/customers` and `/helpers`), enabling different security rules for each.\n*   Tasks are stored in a top-level `/tasks` collection, simplifying task queries and management.\n\n**Access Modeling:**\n*   Tasks include the `customerId`, enabling rules to restrict task access based on the customer's ID and the helper assigned.\n*   Offers include the `helperId` and `taskId` to ensure that only the helper that made the offer or the customer that created the task can access the offers, and only if the task exists.\n*   Admin roles are managed using the `/roles_admin/{uid}` collection. Existence of a document at this path grants admin privileges.\n\n**QAPs Support:**\n*   The structure supports QAPs by segregating data based on user type (customer/helper) and task status. Security rules can efficiently filter list operations based on these attributes without needing complex filtering logic within the rules themselves.\n\n**Invariants:**\n*   The structure supports invariants by ensuring that ownership is explicitly defined in each document (`customerId` in Tasks, `helperId` in Offers). Timestamps can be added to each document to track creation and modification times, ensuring data integrity."
  }
}