{
  "entities": {
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who needs assistance with tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "The email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "The address of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "address"
      ]
    },
    "Helper": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Helper",
      "type": "object",
      "description": "Represents a helper who provides assistance with tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the helper entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the helper."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the helper."
        },
        "email": {
          "type": "string",
          "description": "The email address of the helper.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the helper."
        },
        "address": {
          "type": "string",
          "description": "The address of the helper."
        },
        "skills": {
          "type": "array",
          "description": "List of skills the helper possesses.",
          "items": {
            "type": "string"
          }
        },
        "bio": {
          "type": "string",
          "description": "A short biography of the helper."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "address",
        "skills"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task posted by a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Task)"
        },
        "title": {
          "type": "string",
          "description": "The title of the task."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the task."
        },
        "category": {
          "type": "string",
          "description": "The category of the task (e.g., Cleaning, Laundry)."
        },
        "location": {
          "type": "string",
          "description": "The location where the task needs to be performed."
        },
        "budget": {
          "type": "number",
          "description": "The budget allocated for the task."
        },
        "status": {
          "type": "string",
          "description": "The current status of the task (e.g., Open, Assigned, Completed)."
        },
        "assignedHelperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Task). Nullable if task is not assigned."
        }
      },
      "required": [
        "id",
        "customerId",
        "title",
        "description",
        "category",
        "location",
        "budget",
        "status"
      ]
    },
    "Offer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Offer",
      "type": "object",
      "description": "Represents an offer submitted by a helper for a task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the offer entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Offer)"
        },
        "helperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Offer)"
        },
        "price": {
          "type": "number",
          "description": "The price offered by the helper."
        },
        "availability": {
          "type": "string",
          "description": "The helper's availability to perform the task."
        },
        "message": {
          "type": "string",
          "description": "A message from the helper to the customer."
        }
      },
      "required": [
        "id",
        "taskId",
        "helperId",
        "price",
        "availability",
        "message"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator who manages the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the admin."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the admin."
        },
        "email": {
          "type": "string",
          "description": "The email address of the admin.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Rating": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Rating",
      "type": "object",
      "description": "Represents a rating given by a customer to a helper after task completion.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the rating entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Rating)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Rating)"
        },
        "helperId": {
          "type": "string",
          "description": "Reference to Helper. (Relationship: Helper 1:N Rating)"
        },
        "rating": {
          "type": "number",
          "description": "The rating value (e.g., 1 to 5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment from the customer."
        }
      },
      "required": [
        "id",
        "taskId",
        "customerId",
        "helperId",
        "rating"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profile data. The document ID is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "Helper",
          "schema": {
            "$ref": "#/backend/entities/Helper"
          },
          "description": "Stores helper profile data. The document ID is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{customerId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks created by customers. Includes denormalized 'customerId' for authorization independence.",
          "params": [
            {
              "name": "customerId",
              "description": "The Firebase Auth UID of the customer who created the task."
            },
            {
              "name": "taskId",
              "description": "The unique ID of the task."
            }
          ]
        }
      },
      {
        "path": "/offers/{offerId}",
        "definition": {
          "entityName": "Offer",
          "schema": {
            "$ref": "#/backend/entities/Offer"
          },
          "description": "Stores offers made by helpers for tasks. Includes denormalized 'helperId' and 'taskId' for authorization independence.",
          "params": [
            {
              "name": "offerId",
              "description": "The unique ID of the offer."
            }
          ]
        }
      },
      {
        "path": "/ratings/{ratingId}",
        "definition": {
          "entityName": "Rating",
          "schema": {
            "$ref": "#/backend/entities/Rating"
          },
          "description": "Stores ratings given by customers to helpers. Includes denormalized 'taskId', 'customerId', and 'helperId' for authorization independence.",
          "params": [
            {
              "name": "ratingId",
              "description": "The unique ID of the rating."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Indicates admin status. Document existence determines admin role.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the tasKey application, focusing on task management, user roles (Customers, Helpers, Admins), and efficient data access with robust security rules.  The key principle is Authorization Independence, achieved through denormalization. For example, tasks denormalize customerId, and offers denormalize helperId and taskId, allowing rules to validate access without needing to `get()` parent documents. \n\n*   **Customers:** `/users/{userId}` stores customer profiles. Tasks created by a customer are stored in a subcollection `/users/{userId}/tasks/{taskId}`. This structure enables path-based ownership, simplifying security rules. The `Task` document denormalizes `customerId` to ensure Authorization Independence.\n*   **Helpers:** `/users/{userId}` stores helper profiles. Offers made by helpers are stored in the `/offers/{offerId}` collection, denormalizing the `helperId` and `taskId`.  This avoids deeply nested collections and simplifies querying and security rules.\n*   **Tasks:** Tasks are located under `/users/{customerId}/tasks/{taskId}` to show path-based ownership. The `assignedHelperId` field indicates the assigned helper.  The `Task` object also includes fields such as `title`, `description`, `category`, `location`, `budget`, and `status`.\n*   **Offers:** `/offers/{offerId}` holds offer data including `taskId`, `helperId`, `price`, `availability`, and `message`. The `taskId` and `helperId` are denormalized for authorization independence.  This top-level collection allows for efficient querying of all offers, or offers for a specific task, using collection group queries (if needed).\n*   **Ratings:** Ratings are stored in `/ratings/{ratingId}`. They denormalize `taskId`, `customerId`, and `helperId` for authorization independence and simpler querying.\n*   **Admins:** Admin status is managed via document existence in `/roles_admin/{userId}`.  This leverages the \"existence over content\" pattern for global role management.\n\n\n**QAPs (Rules are not Filters):**\n\n*   The structure supports secure `list` operations.\n*   Tasks are segregated under `/users/{userId}/tasks/{taskId}` and offers under `/offers/{offerId}`, preventing the need to filter based on user roles during listing. Rules can directly check the path to determine access.\n\nThis structure adheres to all core design principles and strategy mandates, ensuring a secure, scalable, and debuggable Firestore database for the tasKey application."
  }
}